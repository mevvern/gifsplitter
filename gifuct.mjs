var e={exports:{}};function r(e){this.data=e,this.pos=0}r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.peekByte=function(){return this.data[this.pos]},r.prototype.readBytes=function(e){return this.data.subarray(this.pos,this.pos+=e)},r.prototype.peekBytes=function(e){return this.data.subarray(this.pos,this.pos+e)},r.prototype.readString=function(e){for(var r="",t=0;t<e;t++)r+=String.fromCharCode(this.readByte());return r},r.prototype.readBitArray=function(){for(var e=[],r=this.readByte(),t=7;t>=0;t--)e.push(!!(r&1<<t));return e},r.prototype.readUnsigned=function(e){var r=this.readBytes(2);return e?(r[1]<<8)+r[0]:(r[0]<<8)+r[1]};var t=r;function a(e){this.stream=new t(e),this.output={}}a.prototype.parse=function(e){return this.parseParts(this.output,e),this.output},a.prototype.parseParts=function(e,r){for(var t=0;t<r.length;t++){var a=r[t];this.parsePart(e,a)}},a.prototype.parsePart=function(e,r){var t,a=r.label;if(!r.requires||r.requires(this.stream,this.output,e))if(r.loop){for(var s=[];r.loop(this.stream);){var i={};this.parseParts(i,r.parts),s.push(i)}e[a]=s}else r.parts?(t={},this.parseParts(t,r.parts),e[a]=t):r.parser?(t=r.parser(this.stream,this.output,e),r.skip||(e[a]=t)):r.bits&&(e[a]=this.parseBits(r.bits))},a.prototype.parseBits=function(e){var r={},t=this.stream.readBitArray();for(var a in e){var s=e[a];s.length?r[a]=t.slice(s.index,s.index+s.length).reduce((function(e,r){return 2*e+r}),0):r[a]=t[s.index]}return r};var s=a,i={readByte:function(){return function(e){return e.readByte()}},readBytes:function(e){return function(r){return r.readBytes(e)}},readString:function(e){return function(r){return r.readString(e)}},readUnsigned:function(e){return function(r){return r.readUnsigned(e)}},readArray:function(e,r){return function(t,a,s){for(var i=r(t,a,s),n=new Array(i),o=0;o<i;o++)n[o]=t.readBytes(e);return n}}},n={label:"blocks",parser:function(e){for(var r=[],t=0,a=e.readByte();0!==a;a=e.readByte())r.push(e.readBytes(a)),t+=a;var s=new Uint8Array(t);t=0;for(var i=0;i<r.length;i++)s.set(r[i],t),t+=r[i].length;return s}},o={label:"gce",requires:function(e){var r=e.peekBytes(2);return 33===r[0]&&249===r[1]},parts:[{label:"codes",parser:i.readBytes(2),skip:!0},{label:"byteSize",parser:i.readByte()},{label:"extras",bits:{future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}}},{label:"delay",parser:i.readUnsigned(!0)},{label:"transparentColorIndex",parser:i.readByte()},{label:"terminator",parser:i.readByte(),skip:!0}]},p={label:"image",requires:function(e){return 44===e.peekByte()},parts:[{label:"code",parser:i.readByte(),skip:!0},{label:"descriptor",parts:[{label:"left",parser:i.readUnsigned(!0)},{label:"top",parser:i.readUnsigned(!0)},{label:"width",parser:i.readUnsigned(!0)},{label:"height",parser:i.readUnsigned(!0)},{label:"lct",bits:{exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}}}]},{label:"lct",requires:function(e,r,t){return t.descriptor.lct.exists},parser:i.readArray(3,(function(e,r,t){return Math.pow(2,t.descriptor.lct.size+1)}))},{label:"data",parts:[{label:"minCodeSize",parser:i.readByte()},n]}]},l={label:"text",requires:function(e){var r=e.peekBytes(2);return 33===r[0]&&1===r[1]},parts:[{label:"codes",parser:i.readBytes(2),skip:!0},{label:"blockSize",parser:i.readByte()},{label:"preData",parser:function(e,r,t){return e.readBytes(t.text.blockSize)}},n]},d={label:"frames",parts:[o,{label:"application",requires:function(e,r,t){var a=e.peekBytes(2);return 33===a[0]&&255===a[1]},parts:[{label:"codes",parser:i.readBytes(2),skip:!0},{label:"blockSize",parser:i.readByte()},{label:"id",parser:function(e,r,t){return e.readString(t.blockSize)}},n]},{label:"comment",requires:function(e,r,t){var a=e.peekBytes(2);return 33===a[0]&&254===a[1]},parts:[{label:"codes",parser:i.readBytes(2),skip:!0},n]},p,l],loop:function(e){var r=e.peekByte();return 33===r||44===r}},u=[{label:"header",parts:[{label:"signature",parser:i.readString(3)},{label:"version",parser:i.readString(3)}]},{label:"lsd",parts:[{label:"width",parser:i.readUnsigned(!0)},{label:"height",parser:i.readUnsigned(!0)},{label:"gct",bits:{exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}}},{label:"backgroundColorIndex",parser:i.readByte()},{label:"pixelAspectRatio",parser:i.readByte()}]},{label:"gct",requires:function(e,r){return r.lsd.gct.exists},parser:i.readArray(3,(function(e,r){return Math.pow(2,r.lsd.gct.size+1)}))},d];const c=s,h=u;function f(e){var r=new Uint8Array(e),t=new c(r);this.raw=t.parse(h),this.raw.hasImages=!1;for(var a=0;a<this.raw.frames.length;a++)if(this.raw.frames[a].image){this.raw.hasImages=!0;break}}f.prototype.decompressFrame=function(e,r){if(e>=this.raw.frames.length)return null;var t=this.raw.frames[e];if(t.image){var a=t.image.descriptor.width*t.image.descriptor.height,s=function(e,r,t){var a,s,i,n,o,p,l,d,u,c,h,f,g,y,b,m,v=4096,x=-1,B=t,w=new Array(t),k=new Array(v),A=new Array(v),S=new Array(v+1);for(o=(s=1<<(f=e))+1,a=s+2,l=x,i=(1<<(n=f+1))-1,u=0;u<s;u++)k[u]=0,A[u]=u;for(h=d=g=y=m=b=0,c=0;c<B;){if(0===y){if(d<n){h+=r[b]<<d,d+=8,b++;continue}if(u=h&i,h>>=n,d-=n,u>a||u==o)break;if(u==s){i=(1<<(n=f+1))-1,a=s+2,l=x;continue}if(l==x){S[y++]=A[u],l=u,g=u;continue}for(p=u,u==a&&(S[y++]=g,u=l);u>s;)S[y++]=A[u],u=k[u];g=255&A[u],S[y++]=g,a<v&&(k[a]=l,A[a]=g,0==(++a&i)&&a<v&&(n++,i+=a)),l=p}y--,w[m++]=S[y],c++}for(c=m;c<B;c++)w[c]=0;return w}(t.image.data.minCodeSize,t.image.data.blocks,a);t.image.descriptor.lct.interlaced&&(s=function(e,r){for(var t=new Array(e.length),a=e.length/r,s=function(a,s){var i=e.slice(s*r,(s+1)*r);t.splice.apply(t,[a*r,r].concat(i))},i=[0,4,2,1],n=[8,8,4,2],o=0,p=0;p<4;p++)for(var l=i[p];l<a;l+=n[p])s(l,o),o++;return t}(s,t.image.descriptor.width));var i={pixels:s,dims:{top:t.image.descriptor.top,left:t.image.descriptor.left,width:t.image.descriptor.width,height:t.image.descriptor.height}};return t.image.descriptor.lct&&t.image.descriptor.lct.exists?i.colorTable=t.image.lct:i.colorTable=this.raw.gct,t.gce&&(i.delay=10*(t.gce.delay||10),i.disposalType=t.gce.extras.disposal,t.gce.extras.transparentColorGiven&&(i.transparentIndex=t.gce.transparentColorIndex)),r&&(i.patch=function(e){for(var r=e.pixels.length,t=new Uint8ClampedArray(4*r),a=0;a<r;a++){var s=4*a,i=e.pixels[a],n=e.colorTable[i];t[s]=n[0],t[s+1]=n[1],t[s+2]=n[2],t[s+3]=i!==e.transparentIndex?255:0}return t}(i)),i}return null},f.prototype.decompressFrames=function(e,r,t){void 0===r&&(r=0),t=void 0===t?this.raw.frames.length:Math.min(t,this.raw.frames.length);for(var a=[],s=r;s<t;s++){this.raw.frames[s].image&&a.push(this.decompressFrame(s,e))}return a},e.exports=f,e.exports.default=f;var g=e.exports;export{g as default};